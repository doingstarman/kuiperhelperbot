# Kuiper Belt Bot

Telegram-бот и мини-приложение для проекта waitingstarman. Репозиторий содержит:
- Express-сервер, обслуживающий статические файлы мини-приложения и health-check.
- Telegram-бота на Telegraf с командами `/start`, `/app` и служебной `/post_channel`.
- Клиентскую часть мини-приложения в каталоге `public/`.
- Скрипт `npm run post:channel` для отправки промо-поста в канал.

## Подготовка окружения

1. Создайте файл `.env` по примеру `.env.example`:
   ```
   BOT_TOKEN=ваш_токен_бота
   WEBAPP_URL=https://your-domain.example
   CHANNEL_ID=@channel_username_or_-100xxxx
   PORT=3000
   ```
2. Убедитесь, что значение `WEBAPP_URL` соответствует домену, где будет размещена статика мини-приложения (HTTPS обязателен для запуска в Telegram).
3. Установите зависимости: `npm install`.

## Локальный запуск

- Запустить сервер и бота: `npm run dev`.
- Проверить, что эндпоинт здоровья отвечает: `curl http://localhost:3000/health`.
- В Telegram отправить боту команды:
  - `/start` — приветствие и кнопка запуска мини-приложения.
  - `/app` — кнопка открытия мини-приложения.
  - `/post_channel` — отправка промо-сообщения в канал (бот должен быть администратором).

## Деплой

1. **Фронтенд.** Разверните содержимое `public/` на статическом хостинге (Vercel, Netlify, GitHub Pages и т.д.) и обновите `WEBAPP_URL` в `.env`. Если используете Render с `render.yaml`, статика автоматически обслуживается Express-сервером — отдельный хост не требуется.
2. **Сервер и бот.** Задеплойте `index.js` на любой Node.js-хостинг с поддержкой фоновых процессов (Render, Railway, Fly.io, VPS). Убедитесь, что:
   - заданы переменные окружения из `.env`;
   - стартовая команда `npm start`;
   - процесс перезапускается автоматически при сбое.

### Быстрый деплой на Render

1. Установите [Render CLI](https://render.com/docs/blueprint-spec#command-line-tool) и залогиньтесь.
2. Обновите локальный файл `.env`, затем выполните:
   ```sh
   render blueprint launch render.yaml
   ```
3. В веб-интерфейсе Render задайте значения `BOT_TOKEN`, `CHANNEL_ID`, `WEBAPP_URL` (обычно `https://<your-service>.onrender.com`) и перезапустите сервис.
4. Проверка: `https://<your-service>.onrender.com/health` → `{ ok: true }`, команды бота работают.

## Подготовка к продакшену

- Обновите ссылки в `public/config.js` на реальные ресурсы проекта.
- Добавьте базовый мониторинг (аптайм-пинг `/health`, логирование ошибок бота).
- Настройте доступ бота к каналу: бот должен быть администратором с правом публикации.

## Скрипты

- `npm run dev` — запуск сервера и бота.
- `npm run start` — запуск сервера и бота в продакшн-режиме.
- `npm run post:channel` — единоразово отправляет промо-сообщение в канал (использует `.env`).
